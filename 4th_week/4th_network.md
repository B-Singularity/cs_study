# 포트

패킷이 실행 중인 특정 애플리케이션까지 전달되려면 패킷에 특정 애플리케이션을
식별할 수 있는 정보가 포함되야 함. 이를 포트라고 한다

## 포트 분류

1. 잘 알려진 포트: 0~1023번 범용적으로 사용되는 시스템 포트
2. 등록된 포트: 1024~49151 흔히 사용되는 애플리케이션 프로토콜에 할당
3. 동적 포트: 49152~65535 자유롭게 사용가능

## NAPT

포트를 활용해 공인 IP 주소를 여러 사설 IP 주소가 공유할 수 있도록 하는 NAT
포트 번호도 테이블에 동시에 기록

## 포트 포워딩

특정 IP주소와 포트 번호 쌍을 특정 호스트에 할당해 놓으면 패킷 보내기 쉬움

# TCP

## MSS

TCP로 전송할 수 있는 최대 페이로드 크기, TCP의 헤더 크기는 제외하고 계산

## 제어비트

기본적으로 8비트로 구성됨 

1. ACK: 세그먼트의 승인을 나타내기 위한 비트
2. SYN: 연결을 수립하기 위한 비트
3. FIN: 연결을 종료하기 위한 비트

## 순서 번호, 확인 응답 번호

1. 순서 번호: 세그먼트의 올바른 송수신 순서를 보장하기 위한 번호, 세그먼트의 첫
바이트에 부여되는 번호
2. 확인 응답 번호: 수신자가 다음으로 받기를 기대하는 순서 번호

## TCP 연결 수립과 종료

1. 쓰리 웨이 핸드 세이크: SYN 세그먼트 보내서 연결 시작, SYN + ACK 세그먼트 보내서 연결 응답
ACK 세그먼트 보내서 대답을 대답함
2. 종료는 SYN 대신 FIN을 보냄

## TCP 상태

1. CLOSED: 아무 연결이 없는 상태
2. LISTEN: 연결 대기 상태
3. SYN-SENT: 액티브 오픈 호스트가 SYN 세그먼트를 보낸 뒤 그에 대한 응답인 SYN + ACK 세그먼트를 기다림
4. SYN-RECEIVED: SYN + ACK 보내고 그에 대한 ACK 세그먼트 기다림
5. ESTABLISHED: 연결이 확립됨
6. FIN-WAIT-1: 첫 번째로 보내는 종료 신호
7. CLOSED-WAIT: 종료 요청인 FIN 세그먼트를 받으면 응답을 보낸 뒤 대기하는 상태
8. FIN-WAIT-2: FIN-WAIT-1 상태에서 ACK 세그먼트를 받고 상대의 FIN 세그먼트를 기다림
9. LAST-ACK: CLOSED-WAIT에서 FIN 세그먼트를 전송한 뒤 이에 대한 ACK 세그먼트를 기다리는 상태
10. TIME-WAIT: 액티브 클로즈 호스트 FIN 세그먼트를 수신한 뒤, ACK 보냄

## UDP

그냥 보내기만 하는 프로토콜

1. 송신지, 수신지 포트: 송수신지의 포트 번호
2. 길이: 헤더를 포함한 UDP 데이터그램의 바이트
3. 체크섬: 오류 발생을 체크, 오류 있다고 생각되면 폐기함

# TCP의 오류, 흐름, 혼잡 제어

## 재전송

1. 중복된 ACK 세그먼트를 수신했을 때

2. 타임아웃이 발생했을 때

위 상황에선 세그먼트를 재전송 해야됨

ARQ란 방법을 이용한다.

* stop and wait ARQ: 재대로 전달했음을 확인할 때까지 새로운 메세지를 보내지 않는다
성능 저하가 있음
* go back n ARQ: 파이프라인을 짜 여러 세그먼트를 전송, 잘못 전송된 세그먼트가 있으면 그것부터 다시 순서대로 보냄
* selective repeat ARQ: 재대로 전송받은 패킷들만 ACK 세그먼트를 보내는 방식, ACK 못받은건 다시 보냄

## 흐름제어

버퍼를 이용하기 때문에 수신, 송신량에 제한이 있다. 이 버퍼를 효율적으로 사용하기 위해 슬라이딩 윈도우를 이용

## 혼잡제어

혼잡 윈도우는 혼잡 없이 전송할 수 있는 데이터양, 이 윈도우 크기를 정하는 게 혼잡 제어 알고리즘

### AIMD: 혼잡이 없으면 1씩 선형증가, 있으면 윈도우를 절반으로
1. 느린 시작: 송신을 2배씩 증가시킨다. 그럼 혼잡 윈도우도 2배씩 늘게됨, 느린 임계치를 정해서 제어함
2. 혼잡 회피: 윈도우 크기를 선형적으로 증가, 타임 아웃이 발생하면 혼잡 윈도우 값은 1, 임계치는 윈도우 절반 값 초기화
3. 빠른 회복: 중복 ACK이 3번째면 느린 시작 건너뛰고 혼잡 회피, 타임 아웃되면 윈도우 크기 1로, 임계치는 절반으로 






